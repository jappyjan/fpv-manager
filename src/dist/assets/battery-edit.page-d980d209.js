import{d as l,R as c,r as n,b as D,j as u,P as w,N as B,L as E,a as f}from"./index-e705403d.js";import{B as v}from"./button-adb08d27.js";function L(t){const{result:[d]}=l.useRxData(c.BATTERY_PRODUCT_LINES,e=>e.findOne().where("id").equals(t.productLineId).and({manufacturer_id:t.manufacturerId})),{result:[a]}=l.useRxData(c.BATTERIES,e=>e.findOne().where("id").equals(t.batteryId).and({product_line_id:t.productLineId})),g=n.useMemo(()=>t.batteryId==="__new__"?"New":a?`edit "${a.id}"`:"not found...",[t.batteryId,a]),I=l.useRxDB(),[r,_]=n.useState(new Date);n.useEffect(()=>{a!=null&&a.bought_at&&_(new Date(a.bought_at))},[a,d]);const[y,b]=n.useState(!1),m=n.useCallback(async()=>{b(!0);try{const e={id:t.batteryId==="__new__"?D.rnd():t.batteryId,product_line_id:t.productLineId,bought_at:r.toISOString()};await I[c.BATTERIES].upsert(e),t.f7router.navigate(`/battery_manufacturers/${t.manufacturerId}/product_lines/${e.product_line_id}/batteries/${e.id}`,{reloadCurrent:!0})}finally{b(!1)}},[r,I,t.batteryId,t.f7router,t.manufacturerId,t.productLineId]),h=n.useMemo(()=>{const e=r.getFullYear(),i=r.getMonth()+1,o=r.getDate();return`${e}-${i.toString().padStart(2,"0")}-${o.toString().padStart(2,"0")}`},[r]);return u.jsxs(w,{name:"Battery Edit Page",children:[u.jsx(B,{title:g,backLink:t.batteryId==="__new__"?"Batteries":d==null?void 0:d.name,children:u.jsx(v,{slot:"right",onClick:m,loading:y,children:"Save"})}),u.jsxs(E,{strongIos:!0,outlineIos:!0,dividersIos:!0,form:!0,formStoreData:!0,id:"battery-edit-form",children:[t.batteryId!=="__new__"&&u.jsx(f,{label:"ID",name:"id",type:"text",readonly:!0}),u.jsx(f,{label:"Bought at",type:"date",placeholder:"Please choose...",value:h,onInput:e=>{const i=e.target.value,[o,S,x]=i.split("-"),s=new Date;s.setFullYear(parseInt(o,10)),s.setMonth(parseInt(S,10)-1),s.setDate(parseInt(x,10)),s.setHours(0,0,0,0),_(s)}})]})]})}export{L as default};
